1. 检索门控（Retrieval Gating）：只在需要时才进行检索
理解：不要对所有用户问题都进行文档检索。很多简单问题（如问天气、问定义）完全可以用模型自身的知识或预设模板回答。盲目检索会浪费钱（API调用和计算成本）和时间（增加延迟）。

具体做法：

语义不确定性：把用户的问题用3-5种方式 paraphrase（转述），让模型用低随机性（low temp）分别回答，然后将这些答案转换成向量（embedding），计算这些向量的离散程度。如果答案五花八门（离散度高），说明模型对这个问题不确定，这时才去检索。

关键词触发：维护一个关键术语词库（如产品SKU、政策代码）。如果用户问题里包含这些词，但模型自身的参数化知识里没有，就触发检索。

2. 真正有效的混合检索（Hybrid Retrieval）
理解：结合传统的关键词检索（BM25/SPLADE）和现代的向量检索，效果比只用一种好得多。

具体做法：

流程：先用BM25找30-50个候选文档，再用向量检索找50-100个，合并后去重，最后用一个更精细的“交叉编码器”模型（reranker）重排序，选出Top 5-8个最相关的。

分块比模型大小更重要：不要简单地把文档切成固定长度。要按语义分块（如根据标题、句子），块大小200-400个词符（token），块之间重叠20-40个token以便保留上下文。每个块都要有唯一ID和字节偏移量，便于后期精准引用。

重排序器：使用在自己领域数据上微调过的重排序模型，效果通常比用更大的通用LLM来排序更好。

3. 具有可执行结构的、可靠的答案（Grounded Answers）
理解：不要让模型自由发挥生成文本。要求它输出结构化的数据（如JSON）。这是客户愿意付费的功能，因为它提供了“审计追踪”，建立了信任。

具体做法：

强制JSON输出：要求模型返回固定格式，包括：答案文本、置信度、引用的来源列表（包含doc_id, URL, 具体文字段起止位置和内容片段）、以及如果置信度低则说明原因。

好处：你可以展示答案的来源（像论文引用一样），并基于此出售“合规性”、“保证”等高级服务。

验证：用严格的JSON schema去校验模型的输出，不合格就要求模型重试或自行修复。

4. 廉价、可靠且可扩展的幻觉控制
理解：用多种低成本方法防止模型胡说八道。

具体做法：

可回答性检查：先用一个轻量级分类器判断用户问题是否能从你的知识库中找到答案。如果不能，就直接告知用户或触发网络搜索。

少数投票弃权：用低随机性让模型生成3个答案。如果它们的关键语义差异很大，就主动弃权（不回答）或触发更多检索。

必须引用清单：对于受监管的内容（价格、安全、法律），强制要求必须附带引用来源，否则就阻止回答。

5. 减少（AI）智能体编码不可靠性的模式
理解：让AI（如Claude Code）写代码时更可靠，减少错误修改。

具体做法：

测试优先循环：让AI先为要修复的bug或要加的功能写测试用例，然后再写代码，直到测试通过。这能有效约束AI的行为。

使用差异补丁：让AI提供代码差异（unified diff），而不是重写整个文件。你的工具只应用这个补丁，如果失败则把失败的地方反馈给AI让它重试。

沙盒限制：在安全隔离的环境（如容器）中运行代码，严格限制资源（CPU、内存、时间），默认断网。

小步快跑：限制AI每次只能修改1-3个文件。测试通过后，再允许它进行重构。

6. 客户能感知为“速度”的成本控制
理解：通过缓存等各种技术降低成本，而更快的响应速度是降低成本带来的、客户能直接感受到的好处。

具体做法：

缓存检索结果：对用户查询进行标准化和哈希处理，24-72小时内重复的问题直接使用之前检索到的文档和排序结果。

缓存提示词和嵌入：利用供应商的服务器端缓存，将固定的指令和长的上下文内容缓存起来。

摘要后再附加：不要直接把大段检索到的文本塞给模型，先把它压缩成3-5个要点的摘要（保留引文），再把摘要给模型。这既减少了token消耗，又提高了答案质量。

7. 不盲目扩大召回范围的查询扩展
理解：扩展用户查询以提升检索效果，但要精准，不能扩展得太泛。

具体做法：

实体扩展：提取问句中的核心实体（公司、产品、法规），并包含其别名。

意图扩展：衍生出2个关于用户意图的查询（例如，用户问的是“价格”还是“兼容性”？）。

将扩展后的查询进行混合检索，然后去重和精炼。

8. 将RAG包装成可盈利的产品
理解：不要只把它当作一个聊天机器人卖。换一种思路，把它变成一种监控服务。

具体做法：

卖“监控器”：用同样的技术去监控文档、新闻、文件、变更日志等来源。

每日/每周增量摘要：只推送发生变化的内容，并附带引用。

告警规则：基于实体、阈值、情感变化等触发告警。

定价模式：按监控的实体/主题数量按月收费（例如，10个实体/月$199） + 按席位收费。

信任功能：提供精确到段的引用、可导出的审计日志、在特定领域达到准确率SLA承诺，这些功能能说服客户付更多钱。

证明投资回报率：追踪“回答时间”、“问题解决率”等指标，做成月报发给客户。

9. 一个“洞察监控器”的最小可行流程
理解：实现上述监控产品的一个简单 pipeline 设计。

流程：

数据输入：从各种来源（RSS，文档，API）抓取数据 -> 标准化 -> 建立向量索引。

每日任务：获取最新变化，计算差异，生成带引用的结构化摘要，推送至Slack/邮件。

交互式问答：用户随时提问，先用“检索门控”判断，不可回答则转给搜索或人工。

10. 与收入相关的评估指标
理解：不要只盯着技术指标，要关注与商业成功直接相关的指标。

关键指标：

有引用的答案率：答案是否都附上了准确的来源。

变更覆盖率：监控器抓住了多少重要变更。

首次正确回答时间：速度有多快。

弃权质量：该不该回答的判断是否准确。

用一小套真实用户问题作为“黄金测试集”，每晚自动测试，跟踪效果趋势。